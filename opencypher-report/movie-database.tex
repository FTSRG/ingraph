\chapter{Movie Database}
\label{chp:movie-database}

\section{Queries}

\subsection{query-1}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (m:Movie {title: 'Forrest Gump'})<-[:ACTS_IN]-(a:Actor)
RETURN a.name, a.birthplace
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\projection{\var{a.name},~\var{a.birthplace}} \Big(\alldifferent{} \Big(\expandin{m}{a}{Actor}{\_e362}{ACTS\_IN}{1}{1} \Big(\getvertices{m}{Movie}
\Big)
\Big)
\Big)
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{a.name},~\var{a.birthplace}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{name, birthplace} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{m, \_e362, a} \rangle$
			}
[
	{$\expandin{m}{a}{Actor}{\_e362}{ACTS\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{m, \_e362, a} \rangle$
			}
[
	{$\getvertices{m}{Movie}$
			\\
			\footnotesize
			$\color{gray} \langle \var{m} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
;
\end{forest}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{a.name},~\var{a.birthplace}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{name, birthplace} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{m, \_e362, a} \rangle$
			}
[
	{$\expandin{m}{a}{Actor}{\_e362}{ACTS\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{m, \_e362, a} \rangle$
			}
[
	{$\getvertices{m}{Movie}$
			\\
			\footnotesize
			$\color{gray} \langle \var{m} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
;
\end{forest}
}
\subsection{query-2}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (a:Actor)-[:ACTS_IN]->(m:Movie)
RETURN a, count(*)
ORDER BY count(*) DESC LIMIT 10;
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\text{Cannot convert to expression.}
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}
\subsection{query-3}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (a:Actor)-[:ACTS_IN]->(m:Movie)
WITH a, count(m) AS movie_count
WHERE movie_count < 3
RETURN a, movie_count
ORDER BY movie_count DESC LIMIT 5;
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\text{Cannot convert to expression.}
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}
\subsection{query-4}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (a:Actor)-[:ACTS_IN]->(m:Movie)
WITH a, collect(m.title) AS movies
WHERE length(movies) >= 20
RETURN a, movies
ORDER BY length(movies) DESC LIMIT 10
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\text{Cannot convert to expression.}
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}
\subsection{query-5}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (a:Actor)-[:ACTS_IN]->(m:Movie)
WITH a, count(m) AS acted
WHERE acted >= 10
WITH a, acted
MATCH (a:Director)-[:DIRECTED]->(m:Movie)
WITH a, acted, collect(m.title) AS directed
WHERE length(directed) >= 2
RETURN a.name, acted, directed
ORDER BY length(directed) DESC, acted DESC
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\text{Cannot convert to expression.}
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}
\subsection{query-6}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (a:Actor:Director)-[:ACTS_IN]->(m:Movie)
WITH a, count(1) AS acted
WHERE acted >= 10
WITH a, acted
MATCH (a:Actor:Director)-[:DIRECTED]->(m:Movie)
WITH a, acted, collect(m.title) AS directed
WHERE length(directed) >= 2
RETURN a.name, acted, directed
ORDER BY length(directed) DESC, acted DESC
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\text{Cannot convert to expression.}
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}
\subsection{query-7}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (a:Director)-[:ACTS_IN]->(m)
WITH a, count(m) AS acted
WHERE acted >= 10
WITH a, acted
MATCH (a)-[:DIRECTED]->(m)
WITH a, acted, collect(m.title) AS directed
WHERE length(directed) >= 2
RETURN a.name, acted, directed
ORDER BY length(directed) DESC, acted DESC
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\text{Cannot convert to expression.}
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}
\subsection{query-8}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (u:User {login: 'Michael'})-[:FRIEND]-(f:Person)-[r:RATED]->(m:Movie)
WHERE r.stars > 3
RETURN f.name, m.title, r.stars, r.comment
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\projection{\var{f.name},~\var{m.title},~\var{r.stars},~\var{r.comment}} \Big(\selection{\var{r.stars} > \literal{3}} \Big(\alldifferent{} \Big(\expandout{f}{m}{Movie}{r}{RATED}{1}{1} \Big(\expandboth{u}{f}{Person}{\_e372}{FRIEND}{1}{1} \Big(\getvertices{u}{User}
\Big)
\Big)
\Big)
\Big)
\Big)
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{f.name},~\var{m.title},~\var{r.stars},~\var{r.comment}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{name, title, stars, comment} \rangle$
			}
[
	{$\selection{\var{r.stars} > \literal{3}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u, \_e372, f, r, m} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u, \_e372, f, r, m} \rangle$
			}
[
	{$\expandout{f}{m}{Movie}{r}{RATED}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u, \_e372, f, r, m} \rangle$
			}
[
	{$\expandboth{u}{f}{Person}{\_e372}{FRIEND}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u, \_e372, f} \rangle$
			}
[
	{$\getvertices{u}{User}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
]
]
;
\end{forest}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{f.name},~\var{m.title},~\var{r.stars},~\var{r.comment}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{name, title, stars, comment} \rangle$
			}
[
	{$\selection{\var{r.stars} > \literal{3}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u, \_e372, f, r, m} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u, \_e372, f, r, m} \rangle$
			}
[
	{$\expandout{f}{m}{Movie}{r}{RATED}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u, \_e372, f, r, m} \rangle$
			}
[
	{$\expandboth{u}{f}{Person}{\_e372}{FRIEND}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u, \_e372, f} \rangle$
			}
[
	{$\getvertices{u}{User}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
]
]
;
\end{forest}
}
\subsection{query-9}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (u:User)-[r:RATED]->(m:Movie)<-[r2:RATED]-(likeminded),
(u)-[:FRIEND]-(friend)
WHERE r.stars > 3 AND r2.stars >= 3
RETURN likeminded, count(*)
ORDER BY count(*) desc LIMIT 10
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\text{Cannot convert to expression.}
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}
\subsection{query-10}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (u:User {login: 'Michael'})-[r:RATED]->(m:Movie)
WHERE r.stars > 3
RETURN m.title, r.stars, r.comment
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\projection{\var{m.title},~\var{r.stars},~\var{r.comment}} \Big(\selection{\var{r.stars} > \literal{3}} \Big(\alldifferent{} \Big(\expandout{u}{m}{Movie}{r}{RATED}{1}{1} \Big(\getvertices{u}{User}
\Big)
\Big)
\Big)
\Big)
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{m.title},~\var{r.stars},~\var{r.comment}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{title, stars, comment} \rangle$
			}
[
	{$\selection{\var{r.stars} > \literal{3}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u, r, m} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u, r, m} \rangle$
			}
[
	{$\expandout{u}{m}{Movie}{r}{RATED}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u, r, m} \rangle$
			}
[
	{$\getvertices{u}{User}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
]
;
\end{forest}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{m.title},~\var{r.stars},~\var{r.comment}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{title, stars, comment} \rangle$
			}
[
	{$\selection{\var{r.stars} > \literal{3}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u, r, m} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u, r, m} \rangle$
			}
[
	{$\expandout{u}{m}{Movie}{r}{RATED}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u, r, m} \rangle$
			}
[
	{$\getvertices{u}{User}$
			\\
			\footnotesize
			$\color{gray} \langle \var{u} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
]
;
\end{forest}
}
\subsection{query-11}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (u:User {login: 'Michael'})-[:FRIEND]-()-[r:RATED]->(m:Movie)
RETURN m.title, avg(r.stars), count(*)
ORDER BY AVG(r.stars) DESC, count(*) DESC
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\text{Cannot convert to expression.}
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}
\subsection{query-12}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (tom {name: "Tom Hanks"})
RETURN tom
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\projection{\var{tom}} \Big(\alldifferent{} \Big(\getvertices{tom}{}
\Big)
\Big)
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{tom}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom} \rangle$
			}
[
	{$\getvertices{tom}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
;
\end{forest}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{tom}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom} \rangle$
			}
[
	{$\getvertices{tom}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
;
\end{forest}
}
\subsection{query-13}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (cloudAtlas {title: "Cloud Atlas"})
RETURN cloudAtlas
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\projection{\var{cloudAtlas}} \Big(\alldifferent{} \Big(\getvertices{cloudAtlas}{}
\Big)
\Big)
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{cloudAtlas}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{cloudAtlas} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{cloudAtlas} \rangle$
			}
[
	{$\getvertices{cloudAtlas}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{cloudAtlas} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
;
\end{forest}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{cloudAtlas}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{cloudAtlas} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{cloudAtlas} \rangle$
			}
[
	{$\getvertices{cloudAtlas}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{cloudAtlas} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
;
\end{forest}
}
\subsection{query-14}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (people:Person)
RETURN people.name
LIMIT 10
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\topp{10}{} \Big(\projection{\var{people.name}} \Big(\alldifferent{} \Big(\getvertices{people}{Person}
\Big)
\Big)
\Big)
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\topp{10}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{name} \rangle$
			}
[
	{$\projection{\var{people.name}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{name} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{people} \rangle$
			}
[
	{$\getvertices{people}{Person}$
			\\
			\footnotesize
			$\color{gray} \langle \var{people} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
;
\end{forest}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\topp{10}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{name} \rangle$
			}
[
	{$\projection{\var{people.name}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{name} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{people} \rangle$
			}
[
	{$\getvertices{people}{Person}$
			\\
			\footnotesize
			$\color{gray} \langle \var{people} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
;
\end{forest}
}
\subsection{query-15}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (nineties:Movie)
WHERE nineties.released > 1990 AND nineties.released < 2000
RETURN nineties.title
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\projection{\var{nineties.title}} \Big(\selection{\var{nineties.released} > \literal{1990} \land \var{nineties.released} < \literal{2000}} \Big(\alldifferent{} \Big(\getvertices{nineties}{Movie}
\Big)
\Big)
\Big)
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{nineties.title}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{title} \rangle$
			}
[
	{$\selection{\var{nineties.released} > \literal{1990} \land \var{nineties.released} < \literal{2000}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{nineties} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{nineties} \rangle$
			}
[
	{$\getvertices{nineties}{Movie}$
			\\
			\footnotesize
			$\color{gray} \langle \var{nineties} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
;
\end{forest}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{nineties.title}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{title} \rangle$
			}
[
	{$\selection{\var{nineties.released} > \literal{1990} \land \var{nineties.released} < \literal{2000}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{nineties} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{nineties} \rangle$
			}
[
	{$\getvertices{nineties}{Movie}$
			\\
			\footnotesize
			$\color{gray} \langle \var{nineties} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
;
\end{forest}
}
\subsection{query-16}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (tom:Person {name: "Tom Hanks"})-[:ACTED_IN]->(tomHanksMovies)
RETURN tom, tomHanksMovies
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\projection{\var{tom},~\var{tomHanksMovies}} \Big(\alldifferent{} \Big(\expandout{tom}{tomHanksMovies}{}{\_e376}{ACTED\_IN}{1}{1} \Big(\getvertices{tom}{Person}
\Big)
\Big)
\Big)
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{tom},~\var{tomHanksMovies}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, tomHanksMovies} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e376, tomHanksMovies} \rangle$
			}
[
	{$\expandout{tom}{tomHanksMovies}{}{\_e376}{ACTED\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e376, tomHanksMovies} \rangle$
			}
[
	{$\getvertices{tom}{Person}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
;
\end{forest}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{tom},~\var{tomHanksMovies}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, tomHanksMovies} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e376, tomHanksMovies} \rangle$
			}
[
	{$\expandout{tom}{tomHanksMovies}{}{\_e376}{ACTED\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e376, tomHanksMovies} \rangle$
			}
[
	{$\getvertices{tom}{Person}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
;
\end{forest}
}
\subsection{query-17}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (cloudAtlas {title: "Cloud Atlas"})<-[:DIRECTED]-(directors)
RETURN directors.name
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\projection{\var{directors.name}} \Big(\alldifferent{} \Big(\expandin{cloudAtlas}{directors}{}{\_e377}{DIRECTED}{1}{1} \Big(\getvertices{cloudAtlas}{}
\Big)
\Big)
\Big)
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{directors.name}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{name} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{cloudAtlas, \_e377, directors} \rangle$
			}
[
	{$\expandin{cloudAtlas}{directors}{}{\_e377}{DIRECTED}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{cloudAtlas, \_e377, directors} \rangle$
			}
[
	{$\getvertices{cloudAtlas}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{cloudAtlas} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
;
\end{forest}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{directors.name}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{name} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{cloudAtlas, \_e377, directors} \rangle$
			}
[
	{$\expandin{cloudAtlas}{directors}{}{\_e377}{DIRECTED}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{cloudAtlas, \_e377, directors} \rangle$
			}
[
	{$\getvertices{cloudAtlas}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{cloudAtlas} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
;
\end{forest}
}
\subsection{query-18}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (tom:Person {name:"Tom Hanks"})-[:ACTED_IN]->(m)<-[:ACTED_IN]-(coActors)
RETURN coActors.name
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\projection{\var{coActors.name}} \Big(\alldifferent{} \Big(\expandin{m}{coActors}{}{\_e379}{ACTED\_IN}{1}{1} \Big(\expandout{tom}{m}{}{\_e378}{ACTED\_IN}{1}{1} \Big(\getvertices{tom}{Person}
\Big)
\Big)
\Big)
\Big)
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{coActors.name}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{name} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e378, m, \_e379, coActors} \rangle$
			}
[
	{$\expandin{m}{coActors}{}{\_e379}{ACTED\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e378, m, \_e379, coActors} \rangle$
			}
[
	{$\expandout{tom}{m}{}{\_e378}{ACTED\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e378, m} \rangle$
			}
[
	{$\getvertices{tom}{Person}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
]
;
\end{forest}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{coActors.name}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{name} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e378, m, \_e379, coActors} \rangle$
			}
[
	{$\expandin{m}{coActors}{}{\_e379}{ACTED\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e378, m, \_e379, coActors} \rangle$
			}
[
	{$\expandout{tom}{m}{}{\_e378}{ACTED\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e378, m} \rangle$
			}
[
	{$\getvertices{tom}{Person}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
]
;
\end{forest}
}
\subsection{query-19}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (people:Person)-[relatedTo]-(:Movie {title: "Cloud Atlas"})
RETURN people.name, Type(relatedTo), relatedTo
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\text{Cannot convert to expression.}
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}
\subsection{query-20}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (bacon:Person {name:"Kevin Bacon"})-[*1..4]-(hollywood)
RETURN DISTINCT hollywood
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\duplicateelimination \Big(\projection{\var{hollywood}} \Big(\alldifferent{} \Big(\expandboth{bacon}{hollywood}{}{\_e381}{}{1}{4} \Big(\getvertices{bacon}{Person}
\Big)
\Big)
\Big)
\Big)
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\duplicateelimination$
			\\
			\footnotesize
			$\color{gray} \langle \var{hollywood} \rangle$
			}
[
	{$\projection{\var{hollywood}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{hollywood} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{bacon, \_e381, hollywood} \rangle$
			}
[
	{$\expandboth{bacon}{hollywood}{}{\_e381}{}{1}{4}$
			\\
			\footnotesize
			$\color{gray} \langle \var{bacon, \_e381, hollywood} \rangle$
			}
[
	{$\getvertices{bacon}{Person}$
			\\
			\footnotesize
			$\color{gray} \langle \var{bacon} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
]
;
\end{forest}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\duplicateelimination$
			\\
			\footnotesize
			$\color{gray} \langle \var{hollywood} \rangle$
			}
[
	{$\projection{\var{hollywood}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{hollywood} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{bacon, \_e381, hollywood} \rangle$
			}
[
	{$\expandboth{bacon}{hollywood}{}{\_e381}{}{1}{4}$
			\\
			\footnotesize
			$\color{gray} \langle \var{bacon, \_e381, hollywood} \rangle$
			}
[
	{$\getvertices{bacon}{Person}$
			\\
			\footnotesize
			$\color{gray} \langle \var{bacon} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
]
;
\end{forest}
}
\subsection{query-21}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH p=shortestPath(
(bacon:Person {name:"Kevin Bacon"})-[*]-(meg:Person {name:"Meg Ryan"})
)
RETURN p
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\text{Cannot convert to expression.}
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}
\subsection{query-22}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (tom:Person {name:"Tom Hanks"})-[:ACTED_IN]->(m)<-[:ACTED_IN]-(coActors),
(coActors)-[:ACTED_IN]->(m2)<-[:ACTED_IN]-(cocoActors)
WHERE NOT (tom)-[:ACTED_IN]->(m2)
RETURN cocoActors.name AS Recommended, count(*) AS Strength ORDER BY Strength DESC
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\text{Cannot convert to expression.}
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}
\subsection{query-23}

\subsubsection*{Query specification}

\begin{lstlisting}
MATCH (tom:Person {name:"Tom Hanks"})-[:ACTED_IN]->(m)<-[:ACTED_IN]-(coActors),
(coActors)-[:ACTED_IN]->(m2)<-[:ACTED_IN]-(cruise:Person {name:"Tom Cruise"})
RETURN tom, m, coActors, m2, cruise
\end{lstlisting}

\subsubsection*{Relational algebra expression}

\begin{align*}
\begin{autobreak}
\projection{\var{tom},~\var{m},~\var{coActors},~\var{m2},~\var{cruise}} \Big(\alldifferent{} \Big(\expandin{m}{coActors}{}{\_e388}{ACTED\_IN}{1}{1} \Big(\expandout{tom}{m}{}{\_e387}{ACTED\_IN}{1}{1} \Big(\getvertices{tom}{Person}
\Big)
\Big)
 \join \expandin{m2}{cruise}{Person}{\_e390}{ACTED\_IN}{1}{1} \Big(\expandout{coActors}{m2}{}{\_e389}{ACTED\_IN}{1}{1} \Big(\getvertices{coActors}{}
\Big)
\Big)
\Big)
\Big)
\end{autobreak}
\end{align*}

\subsubsection*{Relational algebra tree}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{tom},~\var{m},~\var{coActors},~\var{m2},~\var{cruise}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, m, coActors, m2, cruise} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e387, m, \_e388, coActors, \_e389, m2, \_e390, cruise} \rangle$
			}
[
	{$\join$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e387, m, \_e388, coActors, \_e389, m2, \_e390, cruise} \rangle$
			}
[
	{$\expandin{m}{coActors}{}{\_e388}{ACTED\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e387, m, \_e388, coActors} \rangle$
			}
[
	{$\expandout{tom}{m}{}{\_e387}{ACTED\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e387, m} \rangle$
			}
[
	{$\getvertices{tom}{Person}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
[
	{$\expandin{m2}{cruise}{Person}{\_e390}{ACTED\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{coActors, \_e389, m2, \_e390, cruise} \rangle$
			}
[
	{$\expandout{coActors}{m2}{}{\_e389}{ACTED\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{coActors, \_e389, m2} \rangle$
			}
[
	{$\getvertices{coActors}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{coActors} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
]
]
;
\end{forest}
}

\subsubsection*{Relational algebra tree for incremental queries}

\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{tom},~\var{m},~\var{coActors},~\var{m2},~\var{cruise}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, m, coActors, m2, cruise} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e387, m, \_e388, coActors, \_e389, m2, \_e390, cruise} \rangle$
			}
[
	{$\join$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e387, m, \_e388, coActors, \_e389, m2, \_e390, cruise} \rangle$
			}
[
	{$\expandin{m}{coActors}{}{\_e388}{ACTED\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e387, m, \_e388, coActors} \rangle$
			}
[
	{$\expandout{tom}{m}{}{\_e387}{ACTED\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom, \_e387, m} \rangle$
			}
[
	{$\getvertices{tom}{Person}$
			\\
			\footnotesize
			$\color{gray} \langle \var{tom} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
[
	{$\expandin{m2}{cruise}{Person}{\_e390}{ACTED\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{coActors, \_e389, m2, \_e390, cruise} \rangle$
			}
[
	{$\expandout{coActors}{m2}{}{\_e389}{ACTED\_IN}{1}{1}$
			\\
			\footnotesize
			$\color{gray} \langle \var{coActors, \_e389, m2} \rangle$
			}
[
	{$\getvertices{coActors}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{coActors} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
]
]
;
\end{forest}
}
