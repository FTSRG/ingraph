\chapter{Movie Database}
\label{chp:movie-database}

\section{query-1}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (m:Movie {title: 'Forrest Gump'})<-[:ACTS_IN]-(a:Actor)
RETURN a.name, a.birthplace
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\projection{\var{a.name},~\var{a.birthplace}} \Big(\alldifferent{} \Big(\expandin{m}{a}{Actor}{\_e640}{ACTS\_IN}{}{} \Big(\getvertices{m}{Movie}\Big)\Big)\Big)
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{a.name},~\var{a.birthplace}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\expandin{m}{a}{Actor}{\_e642}{ACTS\_IN}{}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\getvertices{m}{Movie}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
;
\end{forest}
}

\section{query-10}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (u:User {login: 'Michael'})-[r:RATED]->(m:Movie)
WHERE r.stars > 3
RETURN m.title, r.stars, r.comment
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\projection{\var{m.title},~\var{r.stars},~\var{r.comment}} \Big(\selection{\var{r.stars} > \literal{3}} \Big(\alldifferent{} \Big(\expandout{u}{m}{Movie}{r}{RATED}{}{} \Big(\getvertices{u}{User}\Big)\Big)\Big)\Big)
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{m.title},~\var{r.stars},~\var{r.comment}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\selection{\var{r.stars} > \literal{3}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\expandout{u}{m}{Movie}{r}{RATED}{}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\getvertices{u}{User}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
]
;
\end{forest}
}

\section{query-11}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (u:User {login: 'Michael'})-[:FRIEND]-()-[r:RATED]->(m:Movie)
RETURN m.title, avg(r.stars), count(*)
ORDER BY AVG(r.stars) DESC, count(*) DESC
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\text{Cannot convert to expression.}
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}

\section{query-12}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (tom {name: "Tom Hanks"})
RETURN tom
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\projection{\var{tom}} \Big(\alldifferent{} \Big(\getvertices{tom}{}\Big)\Big)
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{tom}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\getvertices{tom}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
;
\end{forest}
}

\section{query-13}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (cloudAtlas {title: "Cloud Atlas"})
RETURN cloudAtlas
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\projection{\var{cloudAtlas}} \Big(\alldifferent{} \Big(\getvertices{cloudAtlas}{}\Big)\Big)
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{cloudAtlas}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\getvertices{cloudAtlas}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
;
\end{forest}
}

\section{query-14}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (people:Person)
RETURN people.name
LIMIT 10
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\projection{\var{people.name}} \Big(\alldifferent{} \Big(\getvertices{people}{Person}\Big)\Big)
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{people.name}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\getvertices{people}{Person}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
;
\end{forest}
}

\section{query-15}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (nineties:Movie)
WHERE nineties.released > 1990 AND nineties.released < 2000
RETURN nineties.title
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\projection{\var{nineties.title}} \Big(\selection{\var{nineties.released} > \literal{1990} \land \var{nineties.released} < \literal{2000}} \Big(\alldifferent{} \Big(\getvertices{nineties}{Movie}\Big)\Big)\Big)
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{nineties.title}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\selection{\var{nineties.released} > \literal{1990} \land \var{nineties.released} < \literal{2000}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\getvertices{nineties}{Movie}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
;
\end{forest}
}

\section{query-16}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (tom:Person {name: "Tom Hanks"})-[:ACTED_IN]->(tomHanksMovies)
RETURN tom, tomHanksMovies
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\projection{\var{tom},~\var{tomHanksMovies}} \Big(\alldifferent{} \Big(\expandout{tom}{tomHanksMovies}{}{\_e649}{ACTED\_IN}{}{} \Big(\getvertices{tom}{Person}\Big)\Big)\Big)
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{tom},~\var{tomHanksMovies}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\expandout{tom}{tomHanksMovies}{}{\_e651}{ACTED\_IN}{}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\getvertices{tom}{Person}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
;
\end{forest}
}

\section{query-17}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (cloudAtlas {title: "Cloud Atlas"})<-[:DIRECTED]-(directors)
RETURN directors.name
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\projection{\var{directors.name}} \Big(\alldifferent{} \Big(\expandin{cloudAtlas}{directors}{}{\_e652}{DIRECTED}{}{} \Big(\getvertices{cloudAtlas}{}\Big)\Big)\Big)
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{directors.name}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\expandin{cloudAtlas}{directors}{}{\_e654}{DIRECTED}{}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\getvertices{cloudAtlas}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
;
\end{forest}
}

\section{query-18}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (tom:Person {name:"Tom Hanks"})-[:ACTED_IN]->(m)<-[:ACTED_IN]-(coActors)
RETURN coActors.name
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\projection{\var{coActors.name}} \Big(\alldifferent{} \Big(\expandin{m}{coActors}{}{\_e656}{ACTED\_IN}{}{} \Big(\expandout{tom}{m}{}{\_e655}{ACTED\_IN}{}{} \Big(\getvertices{tom}{Person}\Big)\Big)\Big)\Big)
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{coActors.name}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\expandin{m}{coActors}{}{\_e660}{ACTED\_IN}{}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\expandout{tom}{m}{}{\_e659}{ACTED\_IN}{}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\getvertices{tom}{Person}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
]
;
\end{forest}
}

\section{query-19}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (people:Person)-[relatedTo]-(:Movie {title: "Cloud Atlas"})
RETURN people.name, Type(relatedTo), relatedTo
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\text{Cannot convert to expression.}
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}

\section{query-2}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (a:Actor)-[:ACTS_IN]->(m:Movie)
RETURN a, count(*)
ORDER BY count(*) DESC LIMIT 10;
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\text{Cannot convert to expression.}
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}

\section{query-20}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (bacon:Person {name:"Kevin Bacon"})-[*1..4]-(hollywood)
RETURN DISTINCT hollywood
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\duplicateelimination \Big(\projection{\var{hollywood}} \Big(\alldifferent{} \Big(\expandboth{bacon}{hollywood}{}{\_e667}{}{}{} \Big(\getvertices{bacon}{Person}\Big)\Big)\Big)\Big)
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\duplicateelimination$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\projection{\var{hollywood}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\expandboth{bacon}{hollywood}{}{\_e669}{}{}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\getvertices{bacon}{Person}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
]
;
\end{forest}
}

\section{query-21}

\subsection*{Query specification}

\begin{lstlisting}
MATCH p=shortestPath(
(bacon:Person {name:"Kevin Bacon"})-[*]-(meg:Person {name:"Meg Ryan"})
)
RETURN p
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\text{Cannot convert to expression.}
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}

\section{query-22}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (tom:Person {name:"Tom Hanks"})-[:ACTED_IN]->(m)<-[:ACTED_IN]-(coActors),
(coActors)-[:ACTED_IN]->(m2)<-[:ACTED_IN]-(cocoActors)
WHERE NOT (tom)-[:ACTED_IN]->(m2)
RETURN cocoActors.name AS Recommended, count(*) AS Strength ORDER BY Strength DESC
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\text{Cannot convert to expression.}
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}

\section{query-23}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (tom:Person {name:"Tom Hanks"})-[:ACTED_IN]->(m)<-[:ACTED_IN]-(coActors),
(coActors)-[:ACTED_IN]->(m2)<-[:ACTED_IN]-(cruise:Person {name:"Tom Cruise"})
RETURN tom, m, coActors, m2, cruise
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\projection{\var{tom},~\var{m},~\var{coActors},~\var{m2},~\var{cruise}} \Big(\alldifferent{} \Big(\expandin{m}{coActors}{}{\_e686}{ACTED\_IN}{}{} \Big(\expandout{tom}{m}{}{\_e685}{ACTED\_IN}{}{} \Big(\getvertices{tom}{Person}\Big)\Big) \join \expandin{m2}{cruise}{Person}{\_e688}{ACTED\_IN}{}{} \Big(\expandout{coActors}{m2}{}{\_e687}{ACTED\_IN}{}{} \Big(\getvertices{coActors}{}\Big)\Big)\Big)\Big)
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{tom},~\var{m},~\var{coActors},~\var{m2},~\var{cruise}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\join$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\expandin{m}{coActors}{}{\_e694}{ACTED\_IN}{}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\expandout{tom}{m}{}{\_e693}{ACTED\_IN}{}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\getvertices{tom}{Person}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
[
	{$\expandin{m2}{cruise}{Person}{\_e696}{ACTED\_IN}{}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\expandout{coActors}{m2}{}{\_e695}{ACTED\_IN}{}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\getvertices{coActors}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
]
]
;
\end{forest}
}

\section{query-3}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (a:Actor)-[:ACTS_IN]->(m:Movie)
WITH a, count(m) AS movie_count
WHERE movie_count < 3
RETURN a, movie_count
ORDER BY movie_count DESC LIMIT 5;
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\text{Cannot convert to expression.}
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}

\section{query-4}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (a:Actor)-[:ACTS_IN]->(m:Movie)
WITH a, collect(m.title) AS movies
WHERE length(movies) >= 20
RETURN a, movies
ORDER BY length(movies) DESC LIMIT 10
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\text{Cannot convert to expression.}
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}

\section{query-5}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (a:Actor)-[:ACTS_IN]->(m:Movie)
WITH a, count(m) AS acted
WHERE acted >= 10
WITH a, acted
MATCH (a:Director)-[:DIRECTED]->(m:Movie)
WITH a, acted, collect(m.title) AS directed
WHERE length(directed) >= 2
RETURN a.name, acted, directed
ORDER BY length(directed) DESC, acted DESC
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\text{Cannot convert to expression.}
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}

\section{query-6}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (a:Actor:Director)-[:ACTS_IN]->(m:Movie)
WITH a, count(1) AS acted
WHERE acted >= 10
WITH a, acted
MATCH (a:Actor:Director)-[:DIRECTED]->(m:Movie)
WITH a, acted, collect(m.title) AS directed
WHERE length(directed) >= 2
RETURN a.name, acted, directed
ORDER BY length(directed) DESC, acted DESC
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\text{Cannot convert to expression.}
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}

\section{query-7}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (a:Director)-[:ACTS_IN]->(m)
WITH a, count(m) AS acted
WHERE acted >= 10
WITH a, acted
MATCH (a)-[:DIRECTED]->(m)
WITH a, acted, collect(m.title) AS directed
WHERE length(directed) >= 2
RETURN a.name, acted, directed
ORDER BY length(directed) DESC, acted DESC
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\text{Cannot convert to expression.}
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}

\section{query-8}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (u:User {login: 'Michael'})-[:FRIEND]-(f:Person)-[r:RATED]->(m:Movie)
WHERE r.stars > 3
RETURN f.name, m.title, r.stars, r.comment
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\projection{\var{f.name},~\var{m.title},~\var{r.stars},~\var{r.comment}} \Big(\selection{\var{r.stars} > \literal{3}} \Big(\alldifferent{} \Big(\expandout{f}{m}{Movie}{r}{RATED}{}{} \Big(\expandboth{u}{f}{Person}{\_e721}{FRIEND}{}{} \Big(\getvertices{u}{User}\Big)\Big)\Big)\Big)\Big)
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
\begin{forest} for tree={align=center}
[
	{$\projection{\var{f.name},~\var{m.title},~\var{r.stars},~\var{r.comment}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\selection{\var{r.stars} > \literal{3}}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\alldifferent{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\expandout{f}{m}{Movie}{r}{RATED}{}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\expandboth{u}{f}{Person}{\_e723}{FRIEND}{}{}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			}
[
	{$\getvertices{u}{User}$
			\\
			\footnotesize
			$\color{gray} \langle \var{} \rangle$
			},tier=input,for tree={blue,densely dashed}
]
]
]
]
]
]
;
\end{forest}
}

\section{query-9}

\subsection*{Query specification}

\begin{lstlisting}
MATCH (u:User)-[r:RATED]->(m:Movie)<-[r2:RATED]-(likeminded),
(u)-[:FRIEND]-(friend)
WHERE r.stars > 3 AND r2.stars >= 3
RETURN likeminded, count(*)
ORDER BY count(*) desc LIMIT 10
\end{lstlisting}

\subsection*{Relational algebra expression}

\begin{flalign*}
\text{Cannot convert to expression.}
\end{flalign*}

\subsection*{Relational algebra tree}
\adjustbox{max width=\textwidth}{%
\text{Cannot visualize tree.}
}

\subsection*{Relational algebra tree for incremental queries}
\adjustbox{max width=\textwidth}{%
Cannot visualize incremental tree.
}

